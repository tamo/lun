<html>
	<head>
		<title>lun - fun learning tool for students</title>
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<style>
			p {font-size: 130%;}
			button {font-size: 200%; display: block;}
			span {border-style: outset;}
			#next {display: none;}
		</style>
	</head>
	<body>
		<p>
			<span class="tab" onclick="settab(this);start('./taihei-2-summer-2021.txt');">太2</span>
			<span class="tab" onclick="settab(this);start('./taihei-3-summer-2021.txt');">太3</span>
			<span class="tab" onclick="settab(this);start('./nishi-3-u1-u2.txt');">西3並</span>
			<span class="tab" onclick="settab(this);start('./3-pp-146-147.txt');">教p146</span>
		</p>
		<p id="q">範囲を選んでください。<br />
			その後、問題文をタップで答えを表示できます。<br />
			🔊でヒントとして音声を出せます。<br />
			⏭で次の問題に進みます。</p>
		<button id="next">⏭️</button>
		<script>
		function settab(tobeset){
			const tabs = document.getElementsByClassName("tab");
			tabs.forEach(function(tab){
				tab.style.borderStyle="outset";
			});
			tobeset.style.borderStyle='inset';
		}
		function start(fname){
			const datafile = new XMLHttpRequest();
			datafile.open("GET", fname, true);
			datafile.send(null);
			datafile.onload = function(){
				const lines = datafile.responseText.split("\n");
				let qa = [];
				lines.forEach(function(line){
					let pair = line.split("|");
					if (pair.length == 2){
						qa.push(pair);
					} else {
						console.log("[not a qa] " + pair);
					}
				})
				qa.sort(function(a, b){
					return Math.random() - 0.5;
				})
				const next = document.getElementById("next");
				next.style.display = "block";
				next.addEventListener("click", function(e){
					let q_array = qa.pop();
					const q = document.getElementById("q");
					q.innerHTML = "<button id='q_txt'>"
						+ q_array[1]
						+ "</button>"
						+ "<button id='a_pron'>🔊</button>";
					let a_pron_rate = 1.0;
					let a_pron_func = function(e){
						let u = new SpeechSynthesisUtterance();
						u.lang = "en-US";
						u.text = q_array[0];
						u.rate = a_pron_rate;
						a_pron_rate *= 0.8;
						speechSynthesis.speak(u);
					}
					let a_pron = document.getElementById("a_pron");
					a_pron.addEventListener("click", a_pron_func);
					let q_txt = document.getElementById("q_txt");
					q_txt.addEventListener("click", function(e){
						q.innerHTML += "<p id='a_txt'>"
							+ q_array[0]
							+ "</p>";
						let a_pron = document.getElementById("a_pron");
						a_pron.addEventListener("click", a_pron_func);
					});
				});
				next.click();
			};
		}
		</script>
	</body>
</html>